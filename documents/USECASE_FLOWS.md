# ğŸ“Š **USECASE FLOWS - HORIZONTAL VERSION**

## **1ï¸âƒ£ USER REGISTRATION FLOW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   REQ_REGISTER    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   cmd=0x01    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   auth_signup  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   dao_users_create  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Qt Client   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚ server.c     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚dispatcher.c   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚auth_service  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚ dao_users.c      â”‚
â”‚              â”‚ payload:{username â”‚ (Listener)   â”‚               â”‚(Dispatcher)   â”‚               â”‚              â”‚ Extract JSON:      â”‚                  â”‚
â”‚ Register     â”‚  password}        â”‚              â”‚               â”‚               â”‚               â”‚              â”‚ - username="alice" â”‚ - Hash password  â”‚
â”‚ Form         â”‚                   â”‚ - Receive    â”‚               â”‚ - Route by    â”‚               â”‚ - Call       â”‚ - password="xxx"   â”‚ - INSERT users   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚   packet     â”‚               â”‚   category    â”‚               â”‚   auth_      â”‚                    â”‚ - Returns user_idâ”‚
                                   â”‚ - Parse hdr  â”‚               â”‚   (0x01)      â”‚               â”‚   signup()   â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚ - Dispatch   â”‚               â”‚ - Route to    â”‚               â”‚              â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   auth_svc    â”‚               â”‚              â”‚
                                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                                                         â”‚
                                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                         â”‚                                            â”‚                           â”‚
                                                         â–¼                                            â–¼                           â–¼
                                               âœ“ User created               âœ— Username exists   âœ— Database error
                                               â”‚                           â”‚                    â”‚
                                               â””â”€â†’ protocol_send_simple_ok(cmd=0x0102)
                                                                           â””â”€â†’ protocol_send_error("USERNAME_EXISTS")
                                                                                          â”‚
                                                                                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Qt Client   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ TCP Response (cmd=0x0102)                    â”‚
â”‚              â”‚ cmd=0x0102 RES_REGISTER       â”‚ - Success: empty payload                     â”‚
â”‚ Show Result  â”‚                               â”‚ - Error: {"error": "USERNAME_EXISTS"}         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **2ï¸âƒ£ USER LOGIN FLOW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   REQ_LOGIN    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   cmd=0x01    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   auth_login    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   dao_users   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Qt Client   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ server.c     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚dispatcher.c   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚auth_service  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚ dao_users.c      â”‚
â”‚              â”‚ payload:{u,p}   â”‚ (Listener)   â”‚               â”‚(Dispatcher)   â”‚                â”‚              â”‚  password()  â”‚                  â”‚
â”‚ Login Form   â”‚                 â”‚              â”‚               â”‚               â”‚                â”‚              â”‚             â”‚ - SELECT user    â”‚
â”‚              â”‚                 â”‚ - Receive    â”‚               â”‚ - Route by    â”‚                â”‚ - Extract    â”‚             â”‚ - Verify hash    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚   packet     â”‚               â”‚   category    â”‚                â”‚   JSON:u,p   â”‚             â”‚ - Return user_id â”‚
                                 â”‚ - Parse hdr  â”‚               â”‚   (0x01)      â”‚                â”‚              â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚ - Dispatch   â”‚               â”‚ - Route to    â”‚                â”‚              â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   auth_svc    â”‚                â”‚              â”‚
                                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                                                        â”‚
                                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                        â”‚                                             â”‚          â”‚
                                                        â–¼                                             â–¼          â–¼
                                                  âœ“ Verify OK        âœ— Wrong password        âœ— DB error
                                                  â”‚                  â”‚                       â”‚
                                                  â””â”€â”€â†’ dao_sessions_create()
                                                       - Generate token
                                                       - INSERT session
                                                       - Return token
                                                              â”‚
                                                              â–¼
                                                  Update sess->user_id
                                                  protocol_send_response()
                                                  {"token": "abc123xyz..."}
                                                              â”‚
                                                              â””â”€â†’ protocol_send_error()
                                                                  "INVALID_CREDENTIALS"

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Qt Client   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ TCP Response (cmd=0x0104)              â”‚
â”‚              â”‚  cmd=0x0104 RES_LOGIN         â”‚ - Success: {"token": "..."}            â”‚
â”‚ Store token  â”‚  payload:{token}              â”‚ - Error: {"error": "INVALID_..."}      â”‚
â”‚ Go to Lobby  â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **3ï¸âƒ£ ADD FRIEND FLOW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  REQ_ADD_FRIEND  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   cmd=0x02    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   Extract JSON  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   dao_friends_      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Qt Client   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ server.c     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚dispatcher.c   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚friend_id = 2       â”‚ send_request()    â”‚ PostgreSQL  â”‚
â”‚(user_id=1)   â”‚payload:{friend_idâ”‚ (Listener)   â”‚               â”‚ Friends(0x02) â”‚                â”‚ (bob's id)         â”‚                    â”‚             â”‚
â”‚ Search "bob" â”‚  2}              â”‚              â”‚               â”‚               â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   INSERT INTO       â”‚ friend_    â”‚
â”‚ Add Friend   â”‚                  â”‚ - Receive    â”‚               â”‚ - Route to    â”‚                        â”‚                   friend_requests  â”‚ requests  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚   packet     â”‚               â”‚   REQ_ADD_    â”‚                        â–¼                   (1, 2, pending)   â”‚           â”‚
                                  â”‚ - Parse      â”‚               â”‚   FRIEND hdlr â”‚            âœ“ Request sent               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚ - Dispatch   â”‚               â”‚               â”‚            â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â–¼
                                                                                    âœ— Error (user not found)
                                                                                    â”‚
                                                                                    â””â”€â†’ protocol_send_error()

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Qt Client   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ TCP Response (cmd=0x0202)              â”‚
â”‚              â”‚  cmd=0x0202       â”‚ - Success: empty payload               â”‚
â”‚ Show Result  â”‚  RES_ADD_FRIEND   â”‚ - Error: {"error": "..."}              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **4ï¸âƒ£ RESPOND TO FRIEND REQUEST FLOW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  REQ_RESPOND     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   cmd=0x02    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   Extract JSON  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   dao_friends_       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Qt Client   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ server.c     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚dispatcher.c   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚from_user=1         â”‚ respond_request()  â”‚ PostgreSQL  â”‚
â”‚(user_id=2)   â”‚payload:{from_userâ”‚ (Listener)   â”‚               â”‚ Friends(0x02) â”‚                â”‚ accept=1           â”‚                    â”‚             â”‚
â”‚ Accept Req   â”‚ accept}          â”‚              â”‚               â”‚               â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   UPDATE request    â”‚ friends    â”‚
â”‚ from alice   â”‚                  â”‚ - Receive    â”‚               â”‚ - Route to    â”‚                        â”‚                   status='accepted' â”‚ table      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚   packet     â”‚               â”‚   REQ_RESPOND â”‚                        â–¼                   INSERT friends     â”‚            â”‚
                                  â”‚ - Parse      â”‚               â”‚   hdlr        â”‚            âœ“ Request accepted               (1,2) and (2,1)   â”‚            â”‚
                                  â”‚ - Dispatch   â”‚               â”‚               â”‚            â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â–¼
                                                                                    âœ— Error (invalid request)
                                                                                    â”‚
                                                                                    â””â”€â†’ protocol_send_error()

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Qt Client   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ TCP Response (cmd=0x0205)              â”‚
â”‚              â”‚  cmd=0x0205       â”‚ - Success: empty payload               â”‚
â”‚ Update UI    â”‚  RES_RESPOND      â”‚ - Error: {"error": "..."}              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **5ï¸âƒ£ LIST FRIENDS FLOW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  REQ_LIST_      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   cmd=0x02    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   Route to      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   dao_friends_    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Qt Client   â”‚  FRIENDS        â”‚ server.c     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚dispatcher.c   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚handler             â”‚ list(user_id=1)  â”‚ PostgreSQL  â”‚
â”‚(user_id=1)   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ (Listener)   â”‚               â”‚ Friends(0x02) â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚             â”‚
â”‚ View Friends â”‚ (empty payload) â”‚              â”‚               â”‚               â”‚                        â”‚                   SELECT * FROM    â”‚ friends    â”‚
â”‚              â”‚                 â”‚ - Receive    â”‚               â”‚ - Route to    â”‚                        â–¼                   friends WHERE    â”‚ table      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚   packet     â”‚               â”‚   REQ_LIST_   â”‚            Build JSON array:             user_id_1=1      â”‚            â”‚
                                 â”‚ - Parse      â”‚               â”‚   FRIENDS hdlrâ”‚            [{friend1}, {friend2}, ...]  JOIN users table  â”‚            â”‚
                                 â”‚ - Dispatch   â”‚               â”‚               â”‚                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                                                    â”‚
                                                                                                    â–¼
                                                                                    protocol_send_response()
                                                                                    Sends JSON friend list

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Qt Client   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ TCP Response (cmd=0x0207)              â”‚
â”‚              â”‚  cmd=0x0207       â”‚ - Success: [friend JSON array]         â”‚
â”‚ Display      â”‚  RES_LIST_        â”‚ - Error: {"error": "..."}              â”‚
â”‚ Friend List  â”‚  FRIENDS          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **6ï¸âƒ£ SEND DIRECT MESSAGE FLOW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  REQ_SEND_DM    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   cmd=0x03    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   Extract JSON  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   dao_chat_      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Qt Client   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ server.c     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚dispatcher.c   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚to_user=2           â”‚ send_dm()        â”‚ PostgreSQL  â”‚
â”‚(user_id=1)   â”‚payload:{to_user   â”‚ (Listener)   â”‚               â”‚  Chat(0x03)   â”‚                â”‚ content="Hello"    â”‚                  â”‚             â”‚
â”‚ Chat with    â”‚ content}          â”‚              â”‚               â”‚               â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   INSERT INTO    â”‚ messages  â”‚
â”‚ bob (id=2)   â”‚                   â”‚ - Receive    â”‚               â”‚ - Route to    â”‚                        â”‚                   messages table  â”‚ table      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚   packet     â”‚               â”‚   REQ_SEND_DM â”‚                        â–¼                   (1, 2, content) â”‚            â”‚
                                   â”‚ - Parse      â”‚               â”‚   handler     â”‚            âœ“ Message stored              â”‚ read=false      â”‚            â”‚
                                   â”‚ - Dispatch   â”‚               â”‚               â”‚            â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”œâ†’ TODO: NOTIFY_DM
                                                                                               â”‚     if bob online
                                                                                               â–¼
                                                                                    âœ— Error (bob not found)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Qt Client   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ TCP Response (cmd=0x0302)              â”‚
â”‚              â”‚  cmd=0x0302       â”‚ - Success: empty payload               â”‚
â”‚ Message sent â”‚  RES_SEND_DM      â”‚ - Error: {"error": "..."}              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **7ï¸âƒ£ CREATE GAME ROOM FLOW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  REQ_CREATE_   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   cmd=0x04    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   Route to      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   dao_rooms_    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Qt Client   â”‚  ROOM          â”‚ server.c     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚dispatcher.c   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚handler             â”‚ create()        â”‚ PostgreSQL  â”‚
â”‚(user_id=1)   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ (Listener)   â”‚               â”‚  Room(0x04)   â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚             â”‚
â”‚ Lobby Page   â”‚ (empty payload)â”‚              â”‚               â”‚               â”‚                        â”‚                   INSERT INTO    â”‚ rooms table â”‚
â”‚ Click:       â”‚                 â”‚ - Receive    â”‚               â”‚ - Route to    â”‚                        â–¼                   rooms          â”‚             â”‚
â”‚ "Create Room"â”‚                 â”‚   packet     â”‚               â”‚   REQ_CREATE_ â”‚            âœ“ Room created              (host_id=1)    â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚ - Parse      â”‚               â”‚   ROOM hdlr   â”‚            â”‚                       INSERT INTO    â”‚             â”‚
                                 â”‚ - Dispatch   â”‚               â”‚               â”‚            â”‚                       room_members   â”‚             â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚                       (room_id, user_1) 
                                                                                             â–¼                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                                    Build response JSON:
                                                                                    {"room_id": 10}
                                                                                    â”‚
                                                                                    â–¼
                                                                                    protocol_send_response()

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Qt Client   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ TCP Response (cmd=0x0402)              â”‚
â”‚              â”‚  cmd=0x0402       â”‚ - Success: {"room_id": 10}             â”‚
â”‚ Store room   â”‚  RES_CREATE_      â”‚ - Error: {"error": "..."}              â”‚
â”‚ Go to Room   â”‚  ROOM             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **8ï¸âƒ£ JOIN GAME ROOM FLOW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  REQ_JOIN_    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   cmd=0x04    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   Extract JSON  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   dao_rooms_   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Qt Client   â”‚  ROOM         â”‚ server.c     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚dispatcher.c   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚room_id=10          â”‚ join()         â”‚ PostgreSQL  â”‚
â”‚(user_id=2)   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ (Listener)   â”‚               â”‚  Room(0x04)   â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚             â”‚
â”‚ Lobby Page   â”‚payload:{room_idâ”‚              â”‚               â”‚               â”‚                        â”‚                   INSERT INTO    â”‚ room_members
â”‚ See Room #10 â”‚ 10}           â”‚ - Receive    â”‚               â”‚ - Route to    â”‚                        â–¼                   room_members   â”‚ table       â”‚
â”‚ Click: "Join"â”‚                 â”‚   packet     â”‚               â”‚   REQ_JOIN_   â”‚            âœ“ Joined room              (10, user_2)   â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚ - Parse      â”‚               â”‚   ROOM hdlr   â”‚            â”‚                       TODO: Broadcast â”‚             â”‚
                                 â”‚ - Dispatch   â”‚               â”‚               â”‚            â”‚                       NOTIFY_ROOM_   â”‚             â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚                       UPDATE          â”‚             â”‚
                                                                                             â–¼                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                                    âœ— Error (room full)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Qt Client   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ TCP Response (cmd=0x0404)              â”‚
â”‚              â”‚  cmd=0x0404       â”‚ - Success: empty payload               â”‚
â”‚ Join Room    â”‚  RES_JOIN_ROOM    â”‚ - Error: {"error": "ROOM_FULL"}        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **9ï¸âƒ£ GET USER PROFILE FLOW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  REQ_GET_    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   cmd=0x07    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   Route to      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   dao_stats_   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Qt Client   â”‚  PROFILE     â”‚ server.c     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚dispatcher.c   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚handler             â”‚ get_profile()  â”‚ PostgreSQL  â”‚
â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ (Listener)   â”‚               â”‚  Stats(0x07)  â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚             â”‚
â”‚ Click user   â”‚ (empty payloadâ”‚              â”‚               â”‚               â”‚                        â”‚                   SELECT from    â”‚ users +    â”‚
â”‚ "alice"      â”‚ or user_id)  â”‚ - Receive    â”‚               â”‚ - Route to    â”‚                        â–¼                   users,         â”‚ stats      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚   packet     â”‚               â”‚   REQ_GET_    â”‚            Build JSON profile:             user_stats  â”‚ tables     â”‚
                                 â”‚ - Parse      â”‚               â”‚   PROFILE hdlrâ”‚            {username, wins,             JOIN         â”‚             â”‚
                                 â”‚ - Dispatch   â”‚               â”‚               â”‚             losses, score...}             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                                                    â”‚
                                                                                                    â–¼
                                                                                    protocol_send_response()
                                                                                    Sends profile JSON

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Qt Client   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ TCP Response (cmd=0x0702)              â”‚
â”‚              â”‚  cmd=0x0702       â”‚ - Success: {profile JSON}              â”‚
â”‚ Display      â”‚  RES_GET_         â”‚ - Error: {"error": "..."}              â”‚
â”‚ User Stats   â”‚  PROFILE          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **ğŸ”Ÿ GET LEADERBOARD FLOW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  REQ_         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   cmd=0x07    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   Route to      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   dao_stats_     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Qt Client   â”‚  LEADERBOARD  â”‚ server.c     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚dispatcher.c   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚handler             â”‚ get_leaderboard()â”‚ PostgreSQL  â”‚
â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ (Listener)   â”‚               â”‚  Stats(0x07)  â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚             â”‚
â”‚ Click:       â”‚ (empty payloadâ”‚              â”‚               â”‚               â”‚                        â”‚                   SELECT TOP 20  â”‚ user_stats â”‚
â”‚ "Leaderboard"â”‚ or limit=20)  â”‚ - Receive    â”‚               â”‚ - Route to    â”‚                        â–¼                   ORDER BY wins  â”‚ table      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚   packet     â”‚               â”‚   REQ_LEADER  â”‚            Build JSON array:             DESC            â”‚             â”‚
                                 â”‚ - Parse      â”‚               â”‚   BOARD hdlr  â”‚            [{rank1}, {rank2}, ...]      JOIN users     â”‚             â”‚
                                 â”‚ - Dispatch   â”‚               â”‚               â”‚                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                                                    â”‚
                                                                                                    â–¼
                                                                                    protocol_send_response()
                                                                                    Sends leaderboard JSON

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Qt Client   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ TCP Response (cmd=0x0704)              â”‚
â”‚              â”‚  cmd=0x0704       â”‚ - Success: [rank JSON array]           â”‚
â”‚ Display Top  â”‚  RES_LEADERBOARD  â”‚ - Error: {"error": "..."}              â”‚
â”‚ 20 Rankings  â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **ğŸ“‹ SUMMARY TABLE**

| Usecase | Cmd | Status | Key Components |
|---------|-----|--------|-----------------|
| 1. Register | 0x0101/02 | âœ… | `auth_dispatch()` â†’ `auth_signup()` â†’ `dao_users_create()` |
| 2. Login | 0x0103/04 | âœ… | `auth_dispatch()` â†’ `auth_login()` â†’ `dao_users_check_password()` â†’ `dao_sessions_create()` |
| 3. Add Friend | 0x0201/02 | âœ… | `dispatcher` (0x02) â†’ `dao_friends_send_request()` |
| 4. Respond Friend | 0x0204/05 | âœ… | `dispatcher` (0x02) â†’ `dao_friends_respond_request()` |
| 5. List Friends | 0x0206/07 | âœ… | `dispatcher` (0x02) â†’ `dao_friends_list()` |
| 6. Send DM | 0x0301/02 | âœ… | `dispatcher` (0x03) â†’ `dao_chat_send_dm()` |
| 7. Create Room | 0x0401/02 | âœ… | `dispatcher` (0x04) â†’ `dao_rooms_create()` |
| 8. Join Room | 0x0403/04 | âœ… | `dispatcher` (0x04) â†’ `dao_rooms_join()` |
| 9. Get Profile | 0x0701/02 | âœ… | `stats_handle_get_profile()` â†’ `dao_stats_get_profile()` |
| 10. Leaderboard | 0x0703/04 | âœ… | `stats_handle_leaderboard()` â†’ `dao_stats_get_leaderboard()` |

---

## **ğŸ¯ KEY POINTS**

1. **Horizontal Flow**: Client (left) â†’ Server (middle) â†’ Database (right)
2. **All flows follow same pattern**:
   - Client sends REQ with JSON payload
   - Dispatcher routes by command category
   - Service/DAO handles business logic
   - Protocol sends RES or error back
3. **Error handling**: Each flow can branch to error response
4. **Database updates**: Shown in each usecase's table changes

