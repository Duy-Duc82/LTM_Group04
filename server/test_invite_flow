#!/bin/bash
# Test invite flow

echo "=== Building test_invite_flow ==="

cd "$(dirname "$0")"

# Compile
gcc -o ../build/test_invite_flow \
    test/test_invite_flow.c \
    -I include \
    -Wall -Wextra \
    -g

if [ $? -ne 0 ]; then
    echo "Build failed!"
    exit 1
fi

echo "Build successful!"
echo ""
echo "=== Running test ==="
echo ""

# Check if server is running
if ! nc -z 127.0.0.1 9000 2>/dev/null; then
    echo "WARNING: Server is not running on port 9000"
    echo "Please start the server first with: make run"
    echo ""
    read -p "Continue anyway? (y/n) " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        exit 1
    fi
fi

# Run test
../build/test_invite_flow 127.0.0.1 9000
